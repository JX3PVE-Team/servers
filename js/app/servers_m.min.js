$(function(){var e=($("#userUID").val(),$("#userGroupId").val()),t='{{each serverList as server index}}\n<div class="m-result">\n   <div class="m-info">\n       {{server.area}} > {{server.name}}\n       <span class="status status-{{server.status}}">\n           {{server.status | getStatusText}}\n       </span>\n   </div>\n   <div class="m-info">\n       最新开服记录\n       <span class="recent">\n           {{server.latest}}<em>（{{server.latest | getXQDay}}）</em>\n       </span>\n   </div>\n   <div class="m-info">\n       上一次记录\n       <span class="history">\n           {{server.history}}<em>（{{server.history | getXQDay}}）</em>\n       </span>\n   </div>\n   <div class="m-panel">\n       <ul>\n         <!-- 已结操作后同时还要给li添加.has -->\n         <li class="top" data-id="{{server.id}}" data-top="{{server.isTop}}"><i class="u-icon-top {{if server.isTop}}istop{{/if}}"></i><b>{{server.isTop | getTopText}}</b></li>\n         <li class="fav" data-id="{{server.id}}" data-collect="{{server.isCollect}}"><i class="u-icon-fav {{if server.isCollect}}isfav{{/if}}"></i><b>{{server.isCollect | getCollectText}}</b></li>\n         <!-- <li class="feed" data-id="{{server.id}}" data-top="{{server.isFeed}}"><i class="u-icon-feed"></i><b>订阅</b></li> -->\n       </ul>\n   </div>\n</div>\n{{/each}}',n=template.compile(t);template.helper("getTopText",function(e){return e?"取消置顶":"置顶"}),template.helper("getStatusText",function(e){return["畅通","爆满","维护"][e-1]||"未知"}),template.helper("getXQDay",function(e){e=e.replace(/^\s/,"");var t=parseInt(e.substr(0,4)),n=parseInt(e.substr(5,2)),s=parseInt(e.substr(8,2)),r=new Date(t,n-1,s),i=r.getDay(),a="本",o=new Date,l=o.getFullYear(),c=o.getMonth(),u=o.getDate()-o.getDay(),v=new Date(l,c,u);return r.getTime()<v.getTime()&&(a="上"),a+["周天","周一","周二","周三","周四","周五","周六"][i]}),template.helper("getCollectText",function(e){return e?"取消收藏":"收藏"});var s=function(e){for(var t=[],n=[],s=0;s<e.length;s++){var r=e[s];r.isTop?t.push(r):n.push(r)}return t.concat(n)},r=function(e){for(var t={},n=0;n<e.length;n++){var s=e[n];t[s.area]?t[s.area].push(s):t[s.area]=[s]}return t},i=function(){for(var e=[],t=0;t<l.length;t++){var n=l[t];(n.isTop||n.isCollect)&&e.push(n)}return e},a=function(e){if(!e)return l;for(var t=[],n=0;n<l.length;n++){var s=l[n];(-1!=s.area.indexOf(e)||-1!=s.name.indexOf(e))&&t.push(s)}return t},o=function(e){for(var t=0;t<l.length;t++){var n=l[t];if(n.id+""==e+"")return[n]}return[]},l=[],c={},u=function(e,t,n){return l.length&&!n?t&&t({serverList:a(e)}):void jQuery.get("/api/server/list.php",function(e){return e=JSON.parse(e),l=s(e),c=r(l),t&&t({serverList:l})})},v=function(){var e=[],t=null;for(x in c)t||(t=x),e.push("<option value='"+x+"'>"+x+"</option>");document.getElementById("chooseArea").innerHTML=e.join(""),d(t)},d=function(e){for(var t=c[e],n=[],s=0;s<t.length;s++)n.push("<option value='"+t[s].id+"'>"+t[s].name+"</option>");document.getElementById("chooseServer").innerHTML=n.join("")},h=function(e,t,n){jQuery.get("/api/server/action.php",{"do":"top",serverid:e,value:t+""=="1"?0:1},n)},p=function(e,t,n){jQuery.get("/api/server/action.php",{"do":"collect",serverid:e,backgroundcolor:"#ff99cc",value:t+""=="1"?0:1},n)};$("#chooseArea").change(function(){d($(this).val())}),$("#searchLink").click(function(){var e=null;e=$("#search_txt").val()?a($("#search_txt").val()):o($("#chooseServer").val()),D({serverList:e})}),$("#backSearch").click(function(){$("#showDetailsResult").slideUp(),$("#chooseAndSearchContent").slideDown(),$("#top-back").hide()}),$("#backSearchResult").click(function(){$("#showActionResult").slideUp(),$("#showDetailsResult").slideDown()}),$("#top-back").click(function(){$("#showDetailsResult").slideUp(),$("#chooseAndSearchContent").slideDown(),$("#top-back").hide()});var f=function(e){$("#showDetailsResult").slideUp(),$("#showActionResult").slideDown(),$("#showActionResult").find(".app-dialog-tips").hide(),$("#action_error_"+e).show()},g=function(e){e=JSON.parse(e);var t=e.code;return 0!=t?void f(t):void u(null,function(){var e=null;e=$("#search_txt").val()?a($("#search_txt").val()):o($("#chooseServer").val()),D({serverList:e})},!0)},m=function(){$("#searchResult").find(".top").click(function(){return""+e=="7"?void f(1):void h($(this).data("id"),$(this).data("top"),g)}),$("#searchResult").find(".fav").click(function(){return""+e=="7"?void f(1):void p($(this).data("id"),$(this).data("collect"),g)}),$("#searchResult").find(".feed").click(function(){letServerFeed($(this).data("id"),$(this).data("feed"),g)})},D=function(e){$("#searchResult").html(n(e)),e.serverList.length>3&&$("#top-back").show(),$("#chooseAndSearchContent").slideUp(),$("#showDetailsResult").slideDown(),m()};u("",v,!0),$(".app-footer .item-2").click(function(){return""+e=="7"?void f(1):void D({serverList:i()})})});