H.ready(["jquery","template","color","jqColor"],function(){var e='<li class="app-servers-list-item app-servers-list-header">\n    <span class="daqu">大区</span>\n    <span class="fwq">服务器</span>\n    <span class="status">状态</span>\n    <span class="recent">最近开服记录</span>\n    <span class="history">上一次记录</span>\n    <span class="top">置顶</span>\n    <span class="fav">收藏</span>\n    <span class="feed">订阅</span>\n</li>\n<!--第一条被置顶的条目添加.app-servers-list-item-top-->\n<!--被收藏的条目添加.app-servers-list-item-fav，并且行内输出自定义的背景色-->\n<!--没有被收藏和置顶的才添加app-servers-list-item-normal，一旦添加了则移除这个类名-->\n<!--畅通状态1添加status-1-->\n<!--爆满状态2添加status-2-->\n<!--维护状态3添加status-3-->\n\n{{each serverList as server index}} \n  <li class="app-servers-list-item\n      {{if server.isTop}}app-servers-list-item-top{{/if}}\n      {{if server.isCollect}}app-servers-list-item-fav{{/if}}\n      {{server | getNormalClass}}\n      " \n      {{if isShowBGC(server)}}style="background-color:{{server.backgroundcolor}}"{{/if}}>\n      <span class="daqu">{{server.area}}</span>\n      <span class="fwq">{{server.name}}</span>\n      <span class="status status-{{server.status}}">{{server.status | getStatusText}}</span>\n      <span class="recent">{{server.latest}}<em>（{{server.latest | getXQDay}}）</em></span>\n      <span class="history">{{server.history}}<em>（{{server.history | getXQDay}}）</em></span>\n      <!--当点击置顶后，给i添加.istop，并将title修改为"取消置顶"-->\n      <span class="top" data-id="{{server.id}}" data-top="{{server.isTop}}"><i class="u-icon-top {{if server.isTop}}istop{{/if}}" title="{{server.isTop | getTopText}}">置顶</i></span>\n      <span class="fav" data-id="{{server.id}}" data-collect="{{server.isCollect}}"><i class="u-icon-fav {{if server.isCollect}}isfav{{/if}}"  title="{{server.isCollect | getCollectText}}">收藏</i></span>\n      <span class="feed" data-id="{{server.id}}" data-feed="{{server.isFeed}}"><i class="u-icon-feed" title="暂未开放">订阅</i></span>\n  </li>\n{{/each}}',s=[],t=function(e){for(var s=[],t=[],a=0;a<e.length;a++){var i=e[a];i.isTop?s.push(i):t.push(i)}return s.concat(t)},a=function(e){if(!e)return s;for(var t=[],a=0;a<s.length;a++){var i=s[a];(-1!=i.area.indexOf(e)||-1!=i.name.indexOf(e))&&t.push(i)}return t},i=function(e,i,r){return s.length&&!r?i&&i({serverList:a(e)}):void jQuery.get("/api/server/list.php",function(e){return e=JSON.parse(e),s=t(e),i&&i({serverList:s})})},r=function(e,s,t){jQuery.get("/api/server/action.php",{"do":"top",serverid:e,value:s+""=="1"?0:1},function(e){t(JSON.parse(e))})},n=function(e,s,t){},o=function(e,s,t,a){a||(a="#ff9933"),jQuery.get("/api/server/action.php",{"do":"collect",serverid:e,backgroundcolor:a,value:s},function(e){t(JSON.parse(e))})};jQuery(function(s){{var t=window.template,a=(s("#userUID").val(),s("#userGroupId").val()),p=function(e){return 0===e?(s(".app-dialog").hide(),void d(!0)):(s(".app-dialog").show(),s(".app-dialog").find(".app-dialog-tips").hide(),void s(".app-dialog").find("#action_error_"+e).show())};s("#background-color-input").colorPicker({customBG:"#ff99cc",readOnly:!1,init:function(e,s){e.style.backgroundColor=e.value,e.style.color=s.rgbaMixCustom.luminance>.22?"#222":"#ddd"}})}s(".app-dialog .app-dialog-fav-ui").find(".u-btn-go").click(function(){var e=s(this).data("id"),t=s(this).data("isCollect")+""=="1"?0:1;o(e,t,function(e){p(e.code)},s("#background-color-input").val())}),s(".app-dialog .m-title .close").click(function(){s(".app-dialog").hide()}),t.helper("getNormalClass",function(e){return e.isTop||e.isCollect?void 0:"app-servers-list-item-normal"}),t.helper("getTopText",function(e){return e?"取消置顶":"置顶"}),t.helper("getStatusText",function(e){return["畅通","爆满","维护"][e-1]||"未知"}),t.helper("getXQDay",function(e){e=e.replace(/^\s/,"");var s=parseInt(e.substr(0,4)),t=parseInt(e.substr(5,2)),a=parseInt(e.substr(8,2)),i=new Date(s,t-1,a),r=i.getDay(),n="本",o=new Date,p=o.getFullYear(),l=o.getMonth(),c=o.getDate()-o.getDay(),d=new Date(p,l,c);return i.getTime()<d.getTime()&&(n="上"),n+["周天","周一","周二","周三","周四","周五","周六"][r]}),t.helper("getCollectText",function(e){return e?"取消收藏":"收藏"}),t.helper("isShowBGC",function(e){return e.isCollect&&e.backgroundcolor});var l=t.compile(e),c=function(){s("#app-servers-list").find(".app-servers-list-item .top").click(function(){return""+a=="7"?void p(1):void r(s(this).data("id"),s(this).data("top"),function(e){p(e.code)})}),s("#app-servers-list").find(".app-servers-list-item .fav").click(function(){if(""+a=="7")return void p(1);var e=s(this).data("id"),t=s(this).data("collect")+""=="1"?0:1;return 0===t?void o(e,t,function(e){p(e.code)}):(s(".app-dialog").show(),s(".app-dialog").find(".app-dialog-tips").hide(),s(".app-dialog").find(".app-dialog-fav-ui").show(),void s(".app-dialog .app-dialog-fav-ui").find(".u-btn-go").data("id",s(this).data("id")).data("isCollect",s(this).data("collect")))}),s("#app-servers-list").find(".app-servers-list-item .feed").click(function(){n(s(this).data("id"),s(this).data("feed"),function(e){p(e.code)})})},d=function(e){var t=document.getElementById("search_txt").value;t=t.replace(/\s/g,""),i(t,function(e){s("#app-servers-list").html(l(e)),c()},e)};s("#search_btn").click(function(){d(!1)}),s("#search_txt").keyup(function(e){13===e.keyCode&&(e.preventDefault(),d(!1))}),d(!0)})});